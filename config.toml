# Конфигурация мультимодальной RAG-системы
# Обновленная версия с поддержкой гибридного поиска и оптимизации

# ============================================================================
# Ollama настройки
# ============================================================================
[ollama]
# Базовый URL для Ollama API
# base_url = "http://10.0.6.3:11434"
base_url = "http://localhost:11434"

# Модель для текстовых эмбеддингов
# Рекомендуется: nomic-embed-text (высокое качество, 768 размерность)
text_embedding_model = "nomic-embed-text:v1.5"

# Модель Vision-Language Model для генерации описаний изображений
# qwen3-vl доступен в Ollama официально
# Варианты: qwen3-vl:4b, qwen3-vl:8b, qwen3-vl:32b
vlm_model = "qwen3-vl:4b-instruct"
# vlm_model = "blaifa/InternVL3_5:4B"

# Таймаут для запросов к Ollama (в секундах)
timeout = 180.0


# ============================================================================
# Векторная база данных (ChromaDB)
# ============================================================================
[vector_db]
# Путь для хранения векторной БД
# Будет создан автоматически если не существует
path = "./data/rag_engine/chromadb"


# ============================================================================
# Хранилище данных
# ============================================================================
[storage]
# Путь для хранения обработанных изображений
# Изображения сохраняются с хешированными именами для избежания дубликатов
images_path = "./data/rag_engine/storage/"


# ============================================================================
# Параметры chunking (разбиения текста)
# ============================================================================
[chunking]
# Размер текстового чанка (в символах)
# Меньше = точнее поиск, но больше чанков
# Больше = быстрее, но менее точный поиск
chunk_size = 1024

# Перекрытие между чанками (в символах)
# Помогает сохранить контекст на границах чанков
# Рекомендуется 10-15% от chunk_size
chunk_overlap = 128


# ============================================================================
# Параметры поиска
# ============================================================================
[search]
# Максимальное количество результатов поиска
max_results = 5

# Порог схожести для фильтрации результатов (0.0 - 1.0)
# Выше = более строгий фильтр
similarity_threshold = 0.7


# ============================================================================
# Гибридный поиск (BM25 + векторный)
# ============================================================================
[hybrid_search]
# Вес семантического (векторного) поиска (0.0 - 1.0)
# Для концептуальных вопросов ставьте выше
weight_semantic = 0.6

# Вес лексического (BM25) поиска (0.0 - 1.0)
# Для поиска по точным терминам ставьте выше
weight_lexical = 0.4

# Количество кандидатов на этапе retrieval
# Больше = медленнее, но полнее покрытие
top_k_retrieve = 100

# Количество кандидатов для reranking
# Оптимально 40-60 для баланса скорости и качества
top_k_rerank = 50

# Параметр k для Reciprocal Rank Fusion (обычно 60)
rrf_k = 60

# Веса гибридного поиска:
# - Техническая документация: weight_semantic=0.6, weight_lexical=0.4
# - Концептуальные вопросы: weight_semantic=0.8, weight_lexical=0.2
# - Поиск по таблицам: weight_semantic=0.5, weight_lexical=0.5 (авто в коде)


# ============================================================================
# Обработка таблиц (TAG - Table Augmented Generation)
# ============================================================================
[table_processing]
# Максимальный размер чанка таблицы (в символах)
# Большие таблицы будут разбиты на несколько чанков
max_chunk_size = 1000

# TAG использует трехуровневую структуру:
# - metadata: summary, context, размеры
# - structure: заголовки, типы колонок, merged cells
# - content: строки таблицы как словари


# ============================================================================
# Логирование
# ============================================================================
[logging]
# Уровень логирования: DEBUG, INFO, WARNING, ERROR, CRITICAL
level = "INFO"


# ============================================================================
# CORS (Cross-Origin Resource Sharing)
# ============================================================================
[cors]
# Включить/выключить CORS (для веб-интерфейса)
enabled = false

# Разрешенные источники
# ["*"] = все источники (не рекомендуется для production)
origins = ["*"]

